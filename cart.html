<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Orders - RedStore</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
.container { margin-top: 40px; margin-bottom: 40px; }
.table img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; }
.status { padding: 5px 10px; border-radius: 5px; font-weight: 600; color: white; text-align:center; }
.status.Processing { background-color: #007bff; }
.status.Pending { background-color: #fd7e14; }
.status.Delivered { background-color: #28a745; }
.alert-success { margin-top: 20px; }
</style>
</head>
<body>

<div class="container">
    <h2 class="mb-4 text-center">Your Orders</h2>
    <div id="orderSuccessMsg" class="alert alert-success text-center d-none">
        Order Placed Successfully!
    </div>
    <div id="noOrdersMsg" class="alert alert-warning text-center d-none">
        No orders placed yet.
    </div>
    <div class="table-responsive">
        <table class="table table-bordered align-middle" id="ordersTable">
            <thead class="table-dark">
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th>Payment</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <!-- Orders dynamically inserted here -->
            </tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBe6T75YFS3MACQ1Drmrrj6xeRlMIwT7s4",
  authDomain: "myshop-1dbc9.firebaseapp.com",
  databaseURL: "https://myshop-1dbc9-default-rtdb.firebaseio.com",
  projectId: "myshop-1dbc9",
  storageBucket: "myshop-1dbc9.appspot.com",
  messagingSenderId: "81466489688",
  appId: "1:81466489688:web:e225da8670b2314dd1432d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Success Message =====
if (localStorage.getItem("orderPlaced") === "true") {
    document.getElementById("orderSuccessMsg").classList.remove("d-none");
    localStorage.removeItem("orderPlaced");
}

const tableBody = document.querySelector("#ordersTable tbody");
const noOrdersMsg = document.getElementById("noOrdersMsg");
const userId = localStorage.getItem("userId") || "guest";

// ===== Fetch Orders from Firebase =====
db.ref("orders/" + userId).once("value").then(snapshot => {
  if (!snapshot.exists()) {
    noOrdersMsg.classList.remove("d-none");
    return;
  }

  snapshot.forEach(child => {
    const order = child.val();

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>
        <div class="d-flex align-items-center gap-3">
          <img src="${order.image || 'https://via.placeholder.com/80'}" width="80" alt="${order.product}">
          <span>${order.product}</span>
        </div>
      </td>
      <td>${order.qty}</td>
      <td>₹${parseFloat(order.price).toFixed(2)}</td>
      <td>₹${parseFloat(order.total).toFixed(2)}</td>
      <td>${order.payment}</td>
      <td><span class="status ${order.status}">${order.status}</span></td>
    `;
    tableBody.appendChild(tr);
  });
});
</script>
</body>
</html>
