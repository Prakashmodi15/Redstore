<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin CMS</title>
<link rel="stylesheet" href="../CSS/style.css">

<style>
.cms-box{
  max-width:800px;
  margin:50px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
}
.cms-box input, textarea{
  width:100%;
  padding:10px;
  margin:10px 0;
}
.cms-box button{
  padding:10px 20px;
  background:#ff523b;
  color:#fff;
  border:none;
  cursor:pointer;
}
.preview-img{
  max-width:200px;
  display:block;
  margin:10px 0;
}
</style>
</head>

<body>

<div class="cms-box">
  <h2>Home Page Editor</h2>

  <label>Header Title</label>
  <input id="headerTitle">

  <label>Header Subtitle</label>
  <textarea id="headerSubtitle"></textarea>

  <label>Explore Button Text</label>
  <input id="exploreText">

  <label>Header Image</label>
  <input type="file" id="headerImage">
  <img id="headerPreview" class="preview-img">

  <button onclick="saveHome()">Save</button>
</div>

<!-- FIREBASE + IMGBB -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBe6T75YFS3MACQ1Drmrrj6xeRlMIwT7s4",
  authDomain: "myshop-1dbc9.firebaseapp.com",
  projectId: "myshop-1dbc9",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const IMGBB_KEY = "80c26b679da7cc8790c8ab386cc3ba0b";

async function uploadImage(file){
  const fd = new FormData();
  fd.append("image", file);

  const res = await fetch(
    `https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`,
    { method:"POST", body:fd }
  );
  const data = await res.json();
  return data.data.url;
}

window.saveHome = async () => {
  let imgURL = "";

  const file = headerImage.files[0];
  if(file){
    imgURL = await uploadImage(file);
    headerPreview.src = imgURL;
  }

  await setDoc(doc(db,"pages","home"),{
    headerTitle: headerTitle.value,
    headerSubtitle: headerSubtitle.value,
    exploreText: exploreText.value,
    headerImage: imgURL
  });

  alert("Saved Successfully âœ…");
};

// LOAD DATA
(async()=>{
  const snap = await getDoc(doc(db,"pages","home"));
  if(snap.exists()){
    const d = snap.data();
    headerTitle.value = d.headerTitle || "";
    headerSubtitle.value = d.headerSubtitle || "";
    exploreText.value = d.exploreText || "";
    if(d.headerImage){
      headerPreview.src = d.headerImage;
    }
  }
})();
</script>

</body>
</html>
